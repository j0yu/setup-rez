name: CI
on: [push]

jobs:
  test-linux-containers:
    name: ${{ matrix.os }} Py${{ matrix.python }}
    runs-on: ubuntu-latest
    container: ${{ matrix.os }}
    strategy:
      matrix:
        os:
        - "centos:7"
        python:
        - 2.7
        - 3.7
      fail-fast: false  # true

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v1
        with:
          python-version: "${{ matrix.python }}"

      - run: command -v python${{ matrix.python }}
      - run: ls -l $(readlink -m $(command -v python${{ matrix.python }})/../../lib)
      - run: echo "::set-env LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$(readlink -m $(command -v python${{ matrix.python }})/../../lib)"
      - name: Check Python
        run: |
          echo "$LD_LIBRARY_PATH"
          echo $(readlink -m $(command -v python${{ matrix.python }})/../../lib)
          python${{ matrix.python }} -c "import sys; print(sys.version_info)"
      - uses: ./

      - run: rez --version
      - run: rez config local_packages_path
      - run: rez config release_packages_path
      - run: rez config packages_path
      - run: rez view os
      - run: rez view python
