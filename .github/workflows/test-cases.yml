name: Tests
on: push

jobs:
  no_container:
    name: "On VM: ${{ matrix.platform }} Py${{ matrix.python }}"
    runs-on: ${{ matrix.platform }}-latest
    strategy:
      matrix:
        platform: [ubuntu, windows, macos]
        python: [2.7, 3.7]

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python }}
    - uses: ./.
    - run: rez --version

  in_container:
    name: "In Container: ${{ matrix.platform }} Py${{ matrix.python }}"
    runs-on: ubuntu-latest
    container:
      image: ${{ matrix.platform }}
    strategy:
      matrix:
        platform: ["centos:7"]
        python: [2.7, 3.7]

    steps:
    - uses: actions/checkout@v2
    
    - uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python }}
    - run: python${{ matrix.python }} -V

    - uses: ./.
    - run: rez --version